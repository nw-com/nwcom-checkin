<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase é€£æ¥æ¸¬è©¦ - è¥¿åŒ—å‹¤å‹™ç®¡ç†ç³»çµ±</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        .header {
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .header p {
            color: #636e72;
            margin: 0;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        .test-section h3 {
            color: #2d3436;
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        .test-section h3 i {
            margin-right: 10px;
        }
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .btn {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 10px;
        }
        .btn:hover {
            background: #5f3dc4;
        }
        .btn-success {
            background: #00b894;
        }
        .btn-success:hover {
            background: #00a085;
        }
        .console {
            background: #2d3436;
            color: #ddd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <i class="fas fa-network-wired" style="font-size: 48px; color: #6c5ce7; margin-bottom: 20px;"></i>
            <h1>Firebase é€£æ¥æ¸¬è©¦</h1>
            <p>æª¢æŸ¥ç³»çµ±é€£æ¥ç‹€æ…‹å’Œå•é¡Œ</p>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-fire"></i> Firebase åˆå§‹åŒ–ç‹€æ…‹</h3>
            <div id="firebaseStatus" class="status pending">
                <i class="fas fa-clock"></i> æª¢æ¸¬ä¸­...
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-users"></i> èº«ä»½é©—è­‰ç‹€æ…‹</h3>
            <div id="authStatus" class="status pending">
                <i class="fas fa-clock"></i> æª¢æ¸¬ä¸­...
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-database"></i> Firestore é€£æ¥ç‹€æ…‹</h3>
            <div id="firestoreStatus" class="status pending">
                <i class="fas fa-clock"></i> æª¢æ¸¬ä¸­...
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-info-circle"></i> è©³ç´°è³‡è¨Š</h3>
            <div id="console" class="console">
                ç­‰å¾…æª¢æ¸¬çµæœ...
            </div>
        </div>

        <div id="actions" class="hidden">
            <button class="btn" onclick="runTests()">
                <i class="fas fa-redo"></i> é‡æ–°æª¢æ¸¬
            </button>
            <button class="btn btn-success" onclick="goToLogin()">
                <i class="fas fa-sign-in-alt"></i> å‰å¾€ç™»å…¥é é¢
            </button>
            <button class="btn" onclick="goToReset()">
                <i class="fas fa-key"></i> å‰å¾€é‡è¨­å·¥å…·
            </button>
        </div>

        <div id="recommendations" class="test-section hidden">
            <h3><i class="fas fa-lightbulb"></i> å»ºè­°è§£æ±ºæ–¹æ¡ˆ</h3>
            <div id="recommendationsContent"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script src="js/firebase-config.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#e74c3c' : type === 'success' ? '#2ecc71' : '#3498db';
            console.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function updateStatus(elementId, status, message, icon) {
            const element = document.getElementById(elementId);
            element.className = `status ${status}`;
            element.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
        }

        function showRecommendations(recommendations) {
            const recommendationsDiv = document.getElementById('recommendations');
            const content = document.getElementById('recommendationsContent');
            
            let html = '<ul>';
            recommendations.forEach(rec => {
                html += `<li>${rec}</li>`;
            });
            html += '</ul>';
            
            content.innerHTML = html;
            recommendationsDiv.classList.remove('hidden');
        }

        async function runTests() {
            const actions = document.getElementById('actions');
            const recommendations = [];
            
            actions.classList.add('hidden');
            document.getElementById('recommendations').classList.add('hidden');
            
            log('ğŸš€ é–‹å§‹ Firebase é€£æ¥æ¸¬è©¦...');
            
            // æ¸¬è©¦ Firebase åˆå§‹åŒ–
            try {
                log('ğŸ” æª¢æŸ¥ Firebase åˆå§‹åŒ–ç‹€æ…‹...');
                
                if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                    updateStatus('firebaseStatus', 'success', 'Firebase å·²æˆåŠŸåˆå§‹åŒ–', 'check-circle');
                    log('âœ… Firebase åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    updateStatus('firebaseStatus', 'error', 'Firebase åˆå§‹åŒ–å¤±æ•—', 'times-circle');
                    log('âŒ Firebase åˆå§‹åŒ–å¤±æ•—', 'error');
                    recommendations.push('æª¢æŸ¥ firebase-config.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨ä¸”æ­£ç¢ºè¼‰å…¥');
                    recommendations.push('ç¢ºèª Firebase è¨­å®šç‰©ä»¶æ˜¯å¦æ­£ç¢º');
                }
            } catch (error) {
                updateStatus('firebaseStatus', 'error', `Firebase éŒ¯èª¤: ${error.message}`, 'times-circle');
                log(`âŒ Firebase åˆå§‹åŒ–éŒ¯èª¤: ${error.message}`, 'error');
                recommendations.push('æª¢æŸ¥ Firebase SDK æ˜¯å¦æ­£ç¢ºè¼‰å…¥');
            }

            // ç­‰å¾…ä¸€ä¸‹è®“ç³»çµ±åˆå§‹åŒ–
            await new Promise(resolve => setTimeout(resolve, 1000));

            // æ¸¬è©¦èº«ä»½é©—è­‰
            try {
                log('ğŸ” æª¢æŸ¥èº«ä»½é©—è­‰ç‹€æ…‹...');
                
                if (firebase.auth()) {
                    updateStatus('authStatus', 'success', 'èº«ä»½é©—è­‰æœå‹™å¯ç”¨', 'check-circle');
                    log('âœ… Firebase Auth æœå‹™æ­£å¸¸', 'success');
                    
                    // æª¢æŸ¥ç•¶å‰ç”¨æˆ¶ç‹€æ…‹
                    const user = firebase.auth().currentUser;
                    if (user) {
                        log(`ğŸ‘¤ ç•¶å‰å·²ç™»å…¥ç”¨æˆ¶: ${user.email}`, 'success');
                    } else {
                        log('ğŸ‘¤ ç›®å‰æ²’æœ‰ç”¨æˆ¶ç™»å…¥', 'info');
                    }
                } else {
                    updateStatus('authStatus', 'error', 'èº«ä»½é©—è­‰æœå‹™ä¸å¯ç”¨', 'times-circle');
                    log('âŒ Firebase Auth æœå‹™ç•°å¸¸', 'error');
                    recommendations.push('ç¢ºèª Firebase Auth SDK å·²è¼‰å…¥');
                    recommendations.push('æª¢æŸ¥ Firebase æ§åˆ¶å°ä¸­çš„ Auth è¨­å®š');
                }
            } catch (error) {
                updateStatus('authStatus', 'error', `èº«ä»½é©—è­‰éŒ¯èª¤: ${error.message}`, 'times-circle');
                log(`âŒ Firebase Auth éŒ¯èª¤: ${error.message}`, 'error');
                recommendations.push('æª¢æŸ¥ Auth ç¶²åŸŸè¨­å®šæ˜¯å¦æ­£ç¢º');
            }

            // æ¸¬è©¦ Firestore
            try {
                log('ğŸ” æª¢æŸ¥ Firestore é€£æ¥...');
                
                if (firebase.firestore()) {
                    // å˜—è©¦è®€å–ç”¨æˆ¶é›†åˆ
                    const db = firebase.firestore();
                    
                    try {
                        const usersRef = db.collection('users').doc('ADMIN001');
                        const doc = await usersRef.get();
                        
                        if (doc.exists) {
                            updateStatus('firestoreStatus', 'success', 'Firestore é€£æ¥æ­£å¸¸ï¼Œç®¡ç†å“¡å¸³è™Ÿå­˜åœ¨', 'check-circle');
                            log('âœ… Firestore é€£æ¥æˆåŠŸï¼Œç®¡ç†å“¡å¸³è™Ÿå·²å­˜åœ¨', 'success');
                            log(`ğŸ“‹ ç®¡ç†å“¡è³‡æ–™: ${JSON.stringify(doc.data(), null, 2)}`, 'success');
                        } else {
                            updateStatus('firestoreStatus', 'warning', 'Firestore é€£æ¥æ­£å¸¸ï¼Œä½†ç®¡ç†å“¡å¸³è™Ÿä¸å­˜åœ¨', 'exclamation-triangle');
                            log('âš ï¸ Firestore é€£æ¥æˆåŠŸï¼Œä½†ç®¡ç†å“¡å¸³è™Ÿä¸å­˜åœ¨', 'warning');
                            recommendations.push('ç®¡ç†å“¡å¸³è™Ÿä¸å­˜åœ¨ï¼Œéœ€è¦ä½¿ç”¨é‡è¨­å·¥å…·å‰µå»º');
                        }
                    } catch (readError) {
                        updateStatus('firestoreStatus', 'warning', 'Firestore é€£æ¥æ­£å¸¸ä½†è®€å–å¤±æ•—', 'exclamation-triangle');
                        log(`âš ï¸ Firestore é€£æ¥æˆåŠŸä½†è®€å–å¤±æ•—: ${readError.message}`, 'warning');
                        recommendations.push('æª¢æŸ¥ Firestore è¦å‰‡æ˜¯å¦å…è¨±è®€å–æ“ä½œ');
                        recommendations.push('ç¢ºèªè³‡æ–™åº«çµæ§‹æ˜¯å¦æ­£ç¢º');
                    }
                } else {
                    updateStatus('firestoreStatus', 'error', 'Firestore æœå‹™ä¸å¯ç”¨', 'times-circle');
                    log('âŒ Firestore æœå‹™ç•°å¸¸', 'error');
                    recommendations.push('ç¢ºèª Firestore SDK å·²è¼‰å…¥');
                    recommendations.push('æª¢æŸ¥ Firebase æ§åˆ¶å°ä¸­çš„ Firestore è¨­å®š');
                }
            } catch (error) {
                updateStatus('firestoreStatus', 'error', `Firestore éŒ¯èª¤: ${error.message}`, 'times-circle');
                log(`âŒ Firestore é€£æ¥éŒ¯èª¤: ${error.message}`, 'error');
                recommendations.push('æª¢æŸ¥ç¶²è·¯é€£ç·šç‹€æ…‹');
                recommendations.push('ç¢ºèª Firestore è³‡æ–™åº«å·²æ­£ç¢ºå‰µå»º');
            }

            // é¡¯ç¤ºç¸½çµå’Œå»ºè­°
            log('ğŸ“Š æ¸¬è©¦å®Œæˆ', 'info');
            actions.classList.remove('hidden');
            
            if (recommendations.length > 0) {
                showRecommendations(recommendations);
            } else {
                log('ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼ç³»çµ±æ‡‰è©²å¯ä»¥æ­£å¸¸é‹ä½œ', 'success');
            }
        }

        function goToLogin() {
            window.location.href = 'index.html';
        }

        function goToReset() {
            window.location.href = 'auto-reset.html';
        }

        // é é¢è¼‰å…¥å¾Œè‡ªå‹•é–‹å§‹æ¸¬è©¦
        window.addEventListener('load', () => {
            log('ğŸš€ é–‹å§‹è¼‰å…¥ Firebase æ¸¬è©¦...');
            
            // ç­‰å¾… Firebase åˆå§‹åŒ–
            setTimeout(() => {
                runTests();
            }, 2000);
        });
    </script>
</body>
</html>