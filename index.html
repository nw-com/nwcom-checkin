<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿åŒ—å‹¤å‹™ç®¡ç†ç³»çµ±</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ç´…è‰²ä¸»é¡Œæ¨£å¼ */
        :root {
            --primary-red: #dc2626;
            --primary-red-dark: #991b1b;
            --primary-red-light: #ef4444;
            --red-gradient: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        }

        /* æ›´æ–°ç™»å…¥é é¢èƒŒæ™¯ */
        #login-page {
            background: var(--red-gradient);
        }

        /* æ›´æ–°æ‰€æœ‰è—è‰²æ¼¸å±¤ç‚ºç´…è‰² */
        .logo-icon {
            background: var(--red-gradient) !important;
        }

        .login-button {
            background: var(--red-gradient) !important;
        }

        .login-button:hover {
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3) !important;
        }

        /* æ›´æ–°è¡¨å–®ç„¦é»é¡è‰² */
        .form-input:focus {
            border-color: var(--primary-red) !important;
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1) !important;
        }

        .form-input:focus + .input-icon {
            color: var(--primary-red) !important;
        }

        /* æ›´æ–°é€£çµé¡è‰² */
        .forgot-password {
            color: var(--primary-red) !important;
        }

        .forgot-password:hover {
            color: var(--primary-red-dark) !important;
        }

        /* æ›´æ–°æ ¸å–æ–¹å¡Šé¡è‰² */
        .remember-me input[type="checkbox"] {
            accent-color: var(--primary-red) !important;
        }

        /* è„ˆè¡å‹•ç•«é¡è‰²æ›´æ–° */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7) !important;
            }
            70% {
                box-shadow: 0 0 0 20px rgba(220, 38, 38, 0) !important;
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0) !important;
            }
        }

        /* ä¸»ç³»çµ±ç´…è‰²ä¸»é¡Œ */
        .sidebar {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%) !important;
        }

        .btn-primary {
            background: var(--primary-red) !important;
            border-color: var(--primary-red) !important;
        }

        .btn-primary:hover {
            background: var(--primary-red-dark) !important;
            border-color: var(--primary-red-dark) !important;
        }

        .btn-success {
            background: #16a34a !important;
            border-color: #16a34a !important;
        }

        .role-badge {
            background: var(--primary-red) !important;
        }

        /* çµ±è¨ˆå¡ç‰‡å’Œåœ–è¡¨ä¸»é¡Œ */
        .stat-card:hover {
            border-color: var(--primary-red) !important;
        }

        .stat-card i {
            color: var(--primary-red) !important;
        }

        /* å°èˆªæ¬„é¸ä¸­ç‹€æ…‹ */
        .sidebar-menu a.active,
        .sidebar-menu a:hover {
            background: rgba(220, 38, 38, 0.2) !important;
            border-left-color: var(--primary-red) !important;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆä¿æŒä¸€è‡´æ€§ */
        @media (max-width: 768px) {
            .sidebar {
                background: var(--red-gradient) !important;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ç™»å…¥é é¢ -->
        <div id="login-page" class="page">
            <div class="particles" id="particles"></div>
            <div class="login-wrapper">
                <div class="login-container">
                    <div class="logo-section">
                        <div class="logo-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h1 class="system-title">è¥¿åŒ—å‹¤å‹™ç®¡ç†ç³»çµ±</h1>
                        <p class="system-subtitle">å°ˆæ¥­ Â· å®‰å…¨ Â· é«˜æ•ˆ</p>
                    </div>

                    <!-- æˆåŠŸè¨Šæ¯ -->
                    <div class="success-message" id="success-message"></div>

                    <!-- éŒ¯èª¤è¨Šæ¯ -->
                    <div class="error-message" id="error-message"></div>

                    <!-- ç™»å…¥è¡¨å–® -->
                    <form class="login-form" id="login-form">
                        <div class="form-group">
                            <input type="email" id="email" class="form-input" placeholder="é›»å­éƒµä»¶åœ°å€" required>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                        
                        <div class="form-group">
                            <input type="password" id="password" class="form-input" placeholder="å¯†ç¢¼" required>
                            <i class="fas fa-lock input-icon"></i>
                        </div>

                        <div class="form-options">
                            <label class="remember-me">
                                <input type="checkbox" id="remember-me">
                                è¨˜ä½æˆ‘
                            </label>
                            <a href="#" class="forgot-password" id="forgot-password">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
                        </div>

                        <button type="submit" class="login-button" id="login-button">
                            <span id="login-text">ç™»å…¥ç³»çµ±</span>
                        </button>
                    </form>

                    <!-- ç¤ºç¯„å¸³è™Ÿ -->
                    <div class="extra-options">
                        <div class="demo-accounts">
                            <strong>ğŸ”‘ æ¸¬è©¦å¸³è™Ÿï¼š</strong>
                            ç®¡ç†å“¡ - admin@nwcom.com / admin123<br>
                            å“¡å·¥ - user@nwcom.com / user123
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»ç³»çµ±é é¢ -->
        <div id="main-page" class="page hidden">
            <!-- å´é‚Šå°èˆªæ¬„ -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <h3>è¥¿åŒ—å‹¤å‹™ç³»çµ±</h3>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" data-page="dashboard"><i class="fas fa-tachometer-alt"></i>å„€è¡¨æ¿</a></li>
                    <li><a href="#" data-page="checkin"><i class="fas fa-map-marker-alt"></i>å®šä½æ‰“å¡</a></li>
                    <li><a href="#" data-page="schedule"><i class="fas fa-calendar-alt"></i>å‹¤å‹™æ’ç­</a></li>
                    <li><a href="#" data-page="settings"><i class="fas fa-cog"></i>å¸³è™Ÿè¨­å®š</a></li>
                    <li><a href="#" data-page="analytics"><i class="fas fa-chart-bar"></i>æ•¸æ“šåˆ†æ</a></li>
                </ul>
                <div class="sidebar-footer">
                    <button id="logout-btn" class="btn btn-logout">
                        <i class="fas fa-sign-out-alt"></i>ç™»å‡º
                    </button>
                </div>
            </nav>

            <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
            <main class="main-content">
                <header class="top-header">
                    <div class="user-info">
                        <span id="user-name"></span>
                        <span id="user-role" class="role-badge"></span>
                    </div>
                </header>

                <div class="content-area">
                    <!-- å„€è¡¨æ¿ -->
                    <div id="dashboard" class="content-page">
                        <h2>å„€è¡¨æ¿</h2>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <i class="fas fa-users"></i>
                                <div class="stat-info">
                                    <h3>åœ¨å‹¤äººæ•¸</h3>
                                    <span id="active-staff">0</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-clock"></i>
                                <div class="stat-info">
                                    <h3>ä»Šæ—¥å‡ºå‹¤</h3>
                                    <span id="today-attendance">0</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div class="stat-info">
                                    <h3>ç•°å¸¸æé†’</h3>
                                    <span id="alerts">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å®šä½æ‰“å¡ -->
                    <div id="checkin" class="content-page hidden">
                        <h2>å®šä½æ‰“å¡</h2>
                        <div class="checkin-container">
                            <div id="map" class="map-container"></div>
                            <div class="checkin-controls">
                                <button id="checkin-btn" class="btn btn-success">
                                    <i class="fas fa-map-marker-alt"></i>æ‰“å¡
                                </button>
                                <div id="location-info"></div>
                                <div id="today-status" class="today-status">
                                    <h4>ä»Šæ—¥æ‰“å¡è¨˜éŒ„</h4>
                                    <div id="checkin-record">
                                        <p>å°šæœªæ‰“å¡</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ‰“å¡æ­·å²è¨˜éŒ„ -->
                        <div class="checkin-history">
                            <h3>æœ€è¿‘æ‰“å¡è¨˜éŒ„</h3>
                            <div id="checkin-history-list">
                                <table class="checkin-history-table">
                                    <thead>
                                        <tr>
                                            <th>æ—¥æœŸ</th>
                                            <th>ä¸Šç­æ™‚é–“</th>
                                            <th>ä¸‹ç­æ™‚é–“</th>
                                            <th>å·¥ä½œæ™‚é•·</th>
                                            <th>ç‹€æ…‹</th>
                                        </tr>
                                    </thead>
                                    <tbody id="checkin-history-tbody">
                                        <tr>
                                            <td colspan="5" class="text-center">è¼‰å…¥ä¸­...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- å‹¤å‹™æ’ç­ -->
                    <div id="schedule" class="content-page hidden">
                        <h2>å‹¤å‹™æ’ç­</h2>
                        <div class="schedule-container">
                            <div class="schedule-calendar">
                                <div id="calendar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- å¸³è™Ÿè¨­å®š -->
                    <div id="settings" class="content-page hidden">
                        <h2>å¸³è™Ÿè¨­å®š</h2>
                        <div class="settings-container">
                            <form id="settings-form">
                                <div class="form-group">
                                    <label>å§“å</label>
                                    <input type="text" id="settings-name" required>
                                </div>
                                <div class="form-group">
                                    <label>é›»å­éƒµä»¶</label>
                                    <input type="email" id="settings-email" required>
                                </div>
                                <div class="form-group">
                                    <label>æ–°å¯†ç¢¼</label>
                                    <input type="password" id="settings-new-password">
                                </div>
                                <button type="submit" class="btn btn-primary">æ›´æ–°è¨­å®š</button>
                            </form>
                        </div>
                    </div>

                    <!-- æ•¸æ“šåˆ†æ -->
                    <div id="analytics" class="content-page hidden">
                        <div class="analytics-header">
                            <h2>æ•¸æ“šåˆ†æ</h2>
                            <div class="analytics-controls">
                                <select id="analytics-date-range" class="form-control">
                                    <option value="7days">æœ€è¿‘7å¤©</option>
                                    <option value="30days">æœ€è¿‘30å¤©</option>
                                    <option value="90days">æœ€è¿‘90å¤©</option>
                                    <option value="thisMonth">æœ¬æœˆ</option>
                                    <option value="lastMonth">ä¸Šå€‹æœˆ</option>
                                </select>
                                <button id="update-analytics" class="btn btn-primary">
                                    <i class="fas fa-sync-alt"></i> æ›´æ–°
                                </button>
                                <button id="export-report" class="btn btn-success">
                                    <i class="fas fa-download"></i> åŒ¯å‡ºå ±è¡¨
                                </button>
                            </div>
                        </div>

                        <div id="analytics-loading" class="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>è¼‰å…¥åˆ†ææ•¸æ“šä¸­...</p>
                        </div>

                        <!-- çµ±è¨ˆå¡ç‰‡ -->
                        <div class="analytics-cards">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="total-checkins">0</h3>
                                    <p>ç¸½æ‰“å¡æ¬¡æ•¸</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="on-time-rate">0%</h3>
                                    <p>æº–æ™‚ç‡</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="total-schedules">0</h3>
                                    <p>ç¸½æ’ç­æ¬¡æ•¸</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="active-users">0</h3>
                                    <p>æ´»èºäººæ•¸</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="total-alerts">0</h3>
                                    <p>ç•°å¸¸æé†’</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="avg-work-hours">0.0 å°æ™‚</h3>
                                    <p>å¹³å‡å·¥ä½œæ™‚é•·</p>
                                </div>
                            </div>
                        </div>

                        <!-- åœ–è¡¨å€åŸŸ -->
                        <div class="analytics-charts">
                            <div class="chart-container">
                                <h4>æ‰“å¡è¶¨å‹¢</h4>
                                <canvas id="checkin-trend-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>ä½¿ç”¨è€…æ´»å‹•</h4>
                                <canvas id="user-activity-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>æ’ç­åˆ†å¸ƒ</h4>
                                <canvas id="schedule-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>å·¥ä½œæ™‚é•·åˆ†æ</h4>
                                <canvas id="work-hours-chart"></canvas>
                            </div>
                        </div>

                        <!-- è©³ç´°æ•¸æ“šè¡¨æ ¼ -->
                        <div class="analytics-tables">
                            <div class="table-container">
                                <h4>æœ€è¿‘æ‰“å¡è¨˜éŒ„</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>æ—¥æœŸ</th>
                                                <th>äººå“¡</th>
                                                <th>ä¸Šç­æ™‚é–“</th>
                                                <th>ä¸‹ç­æ™‚é–“</th>
                                                <th>ä½ç½®</th>
                                                <th>ç‹€æ…‹</th>
                                            </tr>
                                        </thead>
                                        <tbody id="checkin-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="table-container">
                                <h4>æœ€è¿‘æ’ç­è¨˜éŒ„</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>æ—¥æœŸ</th>
                                                <th>äººå“¡</th>
                                                <th>ç­æ¬¡</th>
                                                <th>é–‹å§‹æ™‚é–“</th>
                                                <th>çµæŸæ™‚é–“</th>
                                                <th>ç‹€æ…‹</th>
                                            </tr>
                                        </thead>
                                        <tbody id="schedule-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- ç™»å…¥é é¢è…³æœ¬ -->
    <script>
        // å‰µå»ºèƒŒæ™¯ç²’å­æ•ˆæœ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // è¡¨å–®é©—è­‰å’Œæäº¤
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('login-button');
            const loginText = document.getElementById('login-text');
            const errorMessage = document.getElementById('error-message');
            const successMessage = document.getElementById('success-message');

            // éš±è—ä¹‹å‰çš„è¨Šæ¯
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            loginButton.classList.add('loading');
            loginText.textContent = 'ç™»å…¥ä¸­...';

            // æ¨¡æ“¬ç™»å…¥éç¨‹
            setTimeout(() => {
                // é€™è£¡å¯ä»¥é€£æ¥åˆ°å¯¦éš›çš„èªè­‰ç³»çµ±
                if (email && password) {
                    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                    successMessage.textContent = 'ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...';
                    successMessage.classList.add('show');
                    
                    // æ¨¡æ“¬è·³è½‰å»¶é²
                    setTimeout(() => {
                        // éš±è—ç™»å…¥é é¢ï¼Œé¡¯ç¤ºä¸»é é¢
                        document.getElementById('login-page').classList.add('hidden');
                        document.getElementById('main-page').classList.remove('hidden');
                        
                        // åˆå§‹åŒ–ä¸»é é¢
                        if (typeof initializeApp === 'function') {
                            initializeApp();
                        }
                    }, 1500);
                } else {
                    // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                    errorMessage.textContent = 'è«‹è¼¸å…¥é›»å­éƒµä»¶å’Œå¯†ç¢¼';
                    errorMessage.classList.add('show');
                    
                    // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
                    loginButton.classList.remove('loading');
                    loginText.textContent = 'ç™»å…¥ç³»çµ±';
                }
            }, 1000);
        });

        // å¿˜è¨˜å¯†ç¢¼è™•ç†
        document.getElementById('forgot-password').addEventListener('click', function(e) {
            e.preventDefault();
            alert('è«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡é‡è¨­å¯†ç¢¼ã€‚\nè¯çµ¡æ–¹å¼ï¼šadmin@nwcom.com');
        });

        // è¨˜ä½æˆ‘åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // è¼‰å…¥è¨˜ä½çš„é›»å­éƒµä»¶
            const rememberedEmail = localStorage.getItem('rememberedEmail');
            if (rememberedEmail) {
                document.getElementById('email').value = rememberedEmail;
                document.getElementById('remember-me').checked = true;
            }
        });

        // è¨˜ä½æˆ‘è¤‡é¸æ¡†è®Šæ›´
        document.getElementById('remember-me').addEventListener('change', function() {
            const email = document.getElementById('email').value;
            if (this.checked && email) {
                localStorage.setItem('rememberedEmail', email);
            } else {
                localStorage.removeItem('rememberedEmail');
            }
        });

        // é›»å­éƒµä»¶è¼¸å…¥è®Šæ›´æ™‚æ›´æ–°è¨˜ä½æˆ‘
        document.getElementById('email').addEventListener('input', function() {
            const rememberMe = document.getElementById('remember-me').checked;
            if (rememberMe) {
                localStorage.setItem('rememberedEmail', this.value);
            }
        });
    </script>
    
    <!-- æ‡‰ç”¨ç¨‹å¼è…³æœ¬ -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/role-manager.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/checkin.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/app.js"></script>
</body>
</html>