<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西北勤務管理系統</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 紅色主題樣式 */
        :root {
            --primary-red: #dc2626;
            --primary-red-dark: #991b1b;
            --primary-red-light: #ef4444;
            --red-gradient: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        }

        /* 更新登入頁面背景 */
        #login-page {
            background: var(--red-gradient);
        }

        /* 更新所有藍色漸層為紅色 */
        .logo-icon {
            background: var(--red-gradient) !important;
        }

        .login-button {
            background: var(--red-gradient) !important;
        }

        .login-button:hover {
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3) !important;
        }

        /* 更新表單焦點顏色 */
        .form-input:focus {
            border-color: var(--primary-red) !important;
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1) !important;
        }

        .form-input:focus + .input-icon {
            color: var(--primary-red) !important;
        }

        /* 更新連結顏色 */
        .forgot-password {
            color: var(--primary-red) !important;
        }

        .forgot-password:hover {
            color: var(--primary-red-dark) !important;
        }

        /* 更新核取方塊顏色 */
        .remember-me input[type="checkbox"] {
            accent-color: var(--primary-red) !important;
        }

        /* 脈衝動畫顏色更新 */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7) !important;
            }
            70% {
                box-shadow: 0 0 0 20px rgba(220, 38, 38, 0) !important;
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0) !important;
            }
        }

        /* 主系統紅色主題 */
        .sidebar {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%) !important;
        }

        .btn-primary {
            background: var(--primary-red) !important;
            border-color: var(--primary-red) !important;
        }

        .btn-primary:hover {
            background: var(--primary-red-dark) !important;
            border-color: var(--primary-red-dark) !important;
        }

        .btn-success {
            background: #16a34a !important;
            border-color: #16a34a !important;
        }

        .role-badge {
            background: var(--primary-red) !important;
        }

        /* 統計卡片和圖表主題 */
        .stat-card:hover {
            border-color: var(--primary-red) !important;
        }

        .stat-card i {
            color: var(--primary-red) !important;
        }

        /* 導航欄選中狀態 */
        .sidebar-menu a.active,
        .sidebar-menu a:hover {
            background: rgba(220, 38, 38, 0.2) !important;
            border-left-color: var(--primary-red) !important;
        }

        /* 響應式設計保持一致性 */
        @media (max-width: 768px) {
            .sidebar {
                background: var(--red-gradient) !important;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 登入頁面 -->
        <div id="login-page" class="page">
            <div class="particles" id="particles"></div>
            <div class="login-wrapper">
                <div class="login-container">
                    <div class="logo-section">
                        <div class="logo-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h1 class="system-title">西北勤務管理系統</h1>
                        <p class="system-subtitle">專業 · 安全 · 高效</p>
                    </div>

                    <!-- 成功訊息 -->
                    <div class="success-message" id="success-message"></div>

                    <!-- 錯誤訊息 -->
                    <div class="error-message" id="error-message"></div>

                    <!-- 登入表單 -->
                    <form class="login-form" id="login-form">
                        <div class="form-group">
                            <input type="email" id="email" class="form-input" placeholder="電子郵件地址" required>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                        
                        <div class="form-group">
                            <input type="password" id="password" class="form-input" placeholder="密碼" required>
                            <i class="fas fa-lock input-icon"></i>
                        </div>

                        <div class="form-options">
                            <label class="remember-me">
                                <input type="checkbox" id="remember-me">
                                記住我
                            </label>
                            <a href="#" class="forgot-password" id="forgot-password">忘記密碼？</a>
                        </div>

                        <button type="submit" class="login-button" id="login-button">
                            <span id="login-text">登入系統</span>
                        </button>
                    </form>

                    <!-- 示範帳號 -->
                    <div class="extra-options">
                        <div class="demo-accounts">
                            <strong>🔑 測試帳號：</strong>
                            管理員 - admin@nwcom.com / admin123<br>
                            員工 - user@nwcom.com / user123
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主系統頁面 -->
        <div id="main-page" class="page hidden">
            <!-- 側邊導航欄 -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <h3>西北勤務系統</h3>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" data-page="dashboard"><i class="fas fa-tachometer-alt"></i>儀表板</a></li>
                    <li><a href="#" data-page="checkin"><i class="fas fa-map-marker-alt"></i>定位打卡</a></li>
                    <li><a href="#" data-page="schedule"><i class="fas fa-calendar-alt"></i>勤務排班</a></li>
                    <li><a href="#" data-page="settings"><i class="fas fa-cog"></i>帳號設定</a></li>
                    <li><a href="#" data-page="analytics"><i class="fas fa-chart-bar"></i>數據分析</a></li>
                </ul>
                <div class="sidebar-footer">
                    <button id="logout-btn" class="btn btn-logout">
                        <i class="fas fa-sign-out-alt"></i>登出
                    </button>
                </div>
            </nav>

            <!-- 主要內容區域 -->
            <main class="main-content">
                <header class="top-header">
                    <div class="user-info">
                        <span id="user-name"></span>
                        <span id="user-role" class="role-badge"></span>
                    </div>
                </header>

                <div class="content-area">
                    <!-- 儀表板 -->
                    <div id="dashboard" class="content-page">
                        <h2>儀表板</h2>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <i class="fas fa-users"></i>
                                <div class="stat-info">
                                    <h3>在勤人數</h3>
                                    <span id="active-staff">0</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-clock"></i>
                                <div class="stat-info">
                                    <h3>今日出勤</h3>
                                    <span id="today-attendance">0</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div class="stat-info">
                                    <h3>異常提醒</h3>
                                    <span id="alerts">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 定位打卡 -->
                    <div id="checkin" class="content-page hidden">
                        <h2>定位打卡</h2>
                        <div class="checkin-container">
                            <div id="map" class="map-container"></div>
                            <div class="checkin-controls">
                                <button id="checkin-btn" class="btn btn-success">
                                    <i class="fas fa-map-marker-alt"></i>打卡
                                </button>
                                <div id="location-info"></div>
                                <div id="today-status" class="today-status">
                                    <h4>今日打卡記錄</h4>
                                    <div id="checkin-record">
                                        <p>尚未打卡</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 打卡歷史記錄 -->
                        <div class="checkin-history">
                            <h3>最近打卡記錄</h3>
                            <div id="checkin-history-list">
                                <table class="checkin-history-table">
                                    <thead>
                                        <tr>
                                            <th>日期</th>
                                            <th>上班時間</th>
                                            <th>下班時間</th>
                                            <th>工作時長</th>
                                            <th>狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody id="checkin-history-tbody">
                                        <tr>
                                            <td colspan="5" class="text-center">載入中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 勤務排班 -->
                    <div id="schedule" class="content-page hidden">
                        <h2>勤務排班</h2>
                        <div class="schedule-container">
                            <div class="schedule-calendar">
                                <div id="calendar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 帳號設定 -->
                    <div id="settings" class="content-page hidden">
                        <h2>帳號設定</h2>
                        <div class="settings-container">
                            <form id="settings-form">
                                <div class="form-group">
                                    <label>姓名</label>
                                    <input type="text" id="settings-name" required>
                                </div>
                                <div class="form-group">
                                    <label>電子郵件</label>
                                    <input type="email" id="settings-email" required>
                                </div>
                                <div class="form-group">
                                    <label>新密碼</label>
                                    <input type="password" id="settings-new-password">
                                </div>
                                <button type="submit" class="btn btn-primary">更新設定</button>
                            </form>
                        </div>
                    </div>

                    <!-- 數據分析 -->
                    <div id="analytics" class="content-page hidden">
                        <div class="analytics-header">
                            <h2>數據分析</h2>
                            <div class="analytics-controls">
                                <select id="analytics-date-range" class="form-control">
                                    <option value="7days">最近7天</option>
                                    <option value="30days">最近30天</option>
                                    <option value="90days">最近90天</option>
                                    <option value="thisMonth">本月</option>
                                    <option value="lastMonth">上個月</option>
                                </select>
                                <button id="update-analytics" class="btn btn-primary">
                                    <i class="fas fa-sync-alt"></i> 更新
                                </button>
                                <button id="export-report" class="btn btn-success">
                                    <i class="fas fa-download"></i> 匯出報表
                                </button>
                            </div>
                        </div>

                        <div id="analytics-loading" class="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>載入分析數據中...</p>
                        </div>

                        <!-- 統計卡片 -->
                        <div class="analytics-cards">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="total-checkins">0</h3>
                                    <p>總打卡次數</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="on-time-rate">0%</h3>
                                    <p>準時率</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="total-schedules">0</h3>
                                    <p>總排班次數</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="active-users">0</h3>
                                    <p>活躍人數</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="total-alerts">0</h3>
                                    <p>異常提醒</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="avg-work-hours">0.0 小時</h3>
                                    <p>平均工作時長</p>
                                </div>
                            </div>
                        </div>

                        <!-- 圖表區域 -->
                        <div class="analytics-charts">
                            <div class="chart-container">
                                <h4>打卡趨勢</h4>
                                <canvas id="checkin-trend-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>使用者活動</h4>
                                <canvas id="user-activity-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>排班分布</h4>
                                <canvas id="schedule-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>工作時長分析</h4>
                                <canvas id="work-hours-chart"></canvas>
                            </div>
                        </div>

                        <!-- 詳細數據表格 -->
                        <div class="analytics-tables">
                            <div class="table-container">
                                <h4>最近打卡記錄</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>人員</th>
                                                <th>上班時間</th>
                                                <th>下班時間</th>
                                                <th>位置</th>
                                                <th>狀態</th>
                                            </tr>
                                        </thead>
                                        <tbody id="checkin-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="table-container">
                                <h4>最近排班記錄</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>人員</th>
                                                <th>班次</th>
                                                <th>開始時間</th>
                                                <th>結束時間</th>
                                                <th>狀態</th>
                                            </tr>
                                        </thead>
                                        <tbody id="schedule-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 登入頁面腳本 -->
    <script>
        // 創建背景粒子效果
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // 表單驗證和提交
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('login-button');
            const loginText = document.getElementById('login-text');
            const errorMessage = document.getElementById('error-message');
            const successMessage = document.getElementById('success-message');

            // 隱藏之前的訊息
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');

            // 顯示載入狀態
            loginButton.classList.add('loading');
            loginText.textContent = '登入中...';

            // 模擬登入過程
            setTimeout(() => {
                // 這裡可以連接到實際的認證系統
                if (email && password) {
                    // 顯示成功訊息
                    successMessage.textContent = '登入成功！正在跳轉...';
                    successMessage.classList.add('show');
                    
                    // 模擬跳轉延遲
                    setTimeout(() => {
                        // 隱藏登入頁面，顯示主頁面
                        document.getElementById('login-page').classList.add('hidden');
                        document.getElementById('main-page').classList.remove('hidden');
                        
                        // 初始化主頁面
                        if (typeof initializeApp === 'function') {
                            initializeApp();
                        }
                    }, 1500);
                } else {
                    // 顯示錯誤訊息
                    errorMessage.textContent = '請輸入電子郵件和密碼';
                    errorMessage.classList.add('show');
                    
                    // 重置按鈕狀態
                    loginButton.classList.remove('loading');
                    loginText.textContent = '登入系統';
                }
            }, 1000);
        });

        // 忘記密碼處理
        document.getElementById('forgot-password').addEventListener('click', function(e) {
            e.preventDefault();
            alert('請聯繫系統管理員重設密碼。\n聯絡方式：admin@nwcom.com');
        });

        // 記住我功能
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // 載入記住的電子郵件
            const rememberedEmail = localStorage.getItem('rememberedEmail');
            if (rememberedEmail) {
                document.getElementById('email').value = rememberedEmail;
                document.getElementById('remember-me').checked = true;
            }
        });

        // 記住我複選框變更
        document.getElementById('remember-me').addEventListener('change', function() {
            const email = document.getElementById('email').value;
            if (this.checked && email) {
                localStorage.setItem('rememberedEmail', email);
            } else {
                localStorage.removeItem('rememberedEmail');
            }
        });

        // 電子郵件輸入變更時更新記住我
        document.getElementById('email').addEventListener('input', function() {
            const rememberMe = document.getElementById('remember-me').checked;
            if (rememberMe) {
                localStorage.setItem('rememberedEmail', this.value);
            }
        });
    </script>
    
    <!-- 應用程式腳本 -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/role-manager.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/checkin.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/app.js"></script>
</body>
</html>